<%- include("../layout.ejs"); %>
<head>
 
  <style>
    .container {
      max-width: 600px;
      margin: auto;
    }
  
    .chat-box {
      border: 1px solid #ddd;
      max-height: 300px;
      overflow-y: auto;
      margin-bottom: 20px;
    }
  
    .messages {
      list-style: none;
      padding: 0;
    }
  
    .messages li {
      margin: 20px 0;
      position: relative;
    }
  
    .sent {
      text-align: right;
    }
  
    .received {
      text-align: left;
    }
  
    .message-content {
      display: inline-block;
      padding: 10px;
      border-radius: 5px;
      background-color: #f1f1f1;
      position: relative;
      max-width: 50%; /* Set max-width to 50% */
    }
  
    .receiver {
      font-size: 10px; /* Adjust the font size as needed */
      position: absolute;
      top: -20px;
      left: 5px;
      padding: 5px;
      display: inline-block;
    }
  
    .receiver-right {
      font-size: 10px; /* Adjust the font size as needed */
      position: absolute;
      top: -20px;
      left: 5px;
      padding: 5px;
      display: inline-block;
    }
  
    .right-hr {
      position: absolute;
      width: 80%;
      left: 100px;
    }
  
    .left-hr {
      position: absolute;
      width: 80%;
      left: 5px;
    }
  
    .timestamp {
      display: none;
      position: absolute;
      bottom: -20px;
      left: 5px;
      background-color: #fff;
      padding: 5px;
      border: 1px solid #ccc;
      font-size: 10px; /* Adjust the font size as needed */
    }
  
    .message-content:hover .timestamp {
      display: block;
    }
  
    .sender {
      font-weight: 450;
      font-size: 16px;
      margin-right: 5px;
    }
  
    .message-form {
      margin-top: 20px;
    }
  
    .form-group {
      margin-bottom: 15px;
    }
  
    .btn-primary {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin: 4px 2px;
      cursor: pointer;
      border-radius: 5px;
    }
  </style>
  
</head>
 
 <body>
  <div class="container">
    <h1>Chat with <%= user.name %></h1>
    <script>function formatTimestamp(timestamp) {
      const date = new Date(timestamp);
      return `${date.getHours()}:${
        (date.getMinutes() < 10 ? "0" : "") + date.getMinutes()
      }`;
    }</script>
    <!-- Display existing messages -->
    <div class="chat-box">
      <ul class="messages">
        <% for (const sentMessage of sortedMessages) { %>
          <% if (sentMessage.senderId == user1 && sentMessage.reciverId == UserId) { %>
            <li class="sent">
              <span class="receiver-right"><%= sentMessage.timestamp %>:</span>
              <hr class="left-hr">
              <span class="sender">Me:</span>
              <span class="message-content">
                
                <%= sentMessage.message %>
             
              </span>
            </li>
          <% } else if (sentMessage.senderId == UserId && sentMessage.reciverId == user1) { %>
            <li class="received">
              <span class="receiver"><%= sentMessage.timestamp %>:</span>
              <hr class="right-hr">
              <span class="sender"><%= user.name %>:</span>
              <span class="message-content">
              
                <%= sentMessage.message %>
               
              </span>
            </li>
          <% } %>
        <% } %>
      </ul>
    </div>

    <!-- Message input form -->
    <form action="/users/<%= UserId %>/send-message" method="post" class="message-form">
      <div class="form-group">
        <textarea class="form-control" id="message" name="message" rows="3" placeholder="Type your message here..."></textarea>
      </div>
      <button type="submit" class="btn btn-primary">Send</button>
    </form>
  </div>
  <!-- ... WebSocket script ... -->
</body>
</html>
